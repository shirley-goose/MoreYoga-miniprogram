# 📱 瑜伽馆小程序管理员操作手册

> **适用对象**：瑜伽馆馆主及管理人员  
> **版本**：v1.0  
> **更新时间**：2024年1月

---

## 🎯 管理员系统概述

本小程序为瑜伽馆提供了完整的管理后台，馆主可以通过手机直接管理课程、用户和预约等功能。

### 主要功能
- 📅 **课程管理**：添加课程、安排日程、管理课表
- 👥 **用户管理**：查看用户信息、管理次卡余额
- 📊 **数据统计**：查看预约情况、课程统计
- 📋 **操作日志**：记录所有管理操作

---

## 🔐 管理员登录

### 登录方式
1. 打开小程序，进入"我的"页面
2. **长按**右上角的设置图标 ⚙️（大约2秒）
3. 系统会自动跳转到管理员登录页面

### 默认管理员账号

#### 🏆 超级管理员
- **账号**：`admin`
- **密码**：`yoga123456`
- **权限**：全部管理权限

#### 👨‍💼 普通管理员
- **账号**：`manager`
- **密码**：`manager888`
- **权限**：课程管理、用户管理

> ⚠️ **安全提醒**：首次登录后请立即修改默认密码！

### 登录功能说明
- ✅ **记住密码**：勾选后下次自动填充账号密码
- 🔄 **自动登录**：有效期内无需重复登录
- 🚪 **安全退出**：支持手动退出登录

---

## 🏠 管理后台主页

登录成功后，您将看到管理后台主页，包含：

### 欢迎信息
- 显示当前登录的管理员姓名
- 显示管理员权限级别

### 今日概览
- **今日预约**：当天新增的预约数量
- **今日课程**：当天安排的课程数量
- **总用户数**：系统中的用户总数

### 功能菜单
- 📅 **课程管理**：管理课程和日程
- 👥 **用户管理**：管理用户信息和次卡
- 📊 **数据统计**：查看各种统计报表
- 📋 **操作日志**：查看管理操作记录

---

## 📅 课程管理详解

### 添加新课程
1. 点击"课程管理"进入课程管理页面
2. 点击"添加课程"按钮
3. 填写课程信息：
   - **课程名称**：如"哈他瑜伽"、"流瑜伽"等
   - **课程描述**：课程简介和特点
   - **课程时长**：一般为60分钟或90分钟
   - **课程价格**：单次课程价格
   - **最大人数**：教室容纳上限
   - **课程分类**：初级、中级、高级等

### 安排课程日程
1. 在课程列表中选择要安排的课程
2. 点击"安排日程"
3. 设置日程信息：
   - **日期**：选择具体日期
   - **开始时间**：如"9:00"
   - **结束时间**：如"10:30"
   - **授课老师**：选择或输入老师姓名
   - **教室**：指定上课地点
   - **特殊说明**：如有特殊要求可备注

### 管理现有课程
- **编辑课程**：修改课程信息
- **删除课程**：删除不再开设的课程
- **查看预约**：查看该课程的预约情况
- **课程统计**：查看课程的受欢迎程度

---

## 👥 用户管理详解

### 查看用户信息
1. 点击"用户管理"进入用户管理页面
2. 可以看到所有注册用户的列表
3. 用户信息包括：
   - **用户昵称**：微信昵称
   - **注册时间**：首次使用小程序时间
   - **次卡余额**：剩余课程次数
   - **预约记录**：历史预约情况

### 管理用户次卡
1. 在用户列表中找到目标用户
2. 点击"管理次卡"
3. 可以进行以下操作：
   - **充值次卡**：增加用户的课程次数
   - **扣减次卡**：减少用户的课程次数
   - **查看消费记录**：查看次卡使用历史

### 次卡操作示例
```
用户：张小美
当前次卡：团课 5次，私教 2次

操作：充值团课10次
结果：团课 15次，私教 2次
```

### 用户预约管理
- **查看预约**：查看用户的所有预约
- **取消预约**：帮助用户取消预约
- **预约历史**：查看用户的上课记录

---

## 📊 数据统计功能

### 课程统计
- **热门课程排行**：最受欢迎的课程类型
- **预约时段分析**：用户喜欢的上课时间
- **老师课程统计**：各位老师的课程数量

### 用户统计
- **新用户增长**：每日新注册用户数
- **活跃用户分析**：经常预约课程的用户
- **次卡消费统计**：次卡销售和使用情况

### 财务报表
- **课程收入**：按课程类型统计收入
- **月度报表**：每月收入和支出统计
- **年度对比**：不同年份的业绩对比

---

## 📋 操作日志功能

### 日志记录内容
系统会自动记录所有管理操作：
- **登录记录**：管理员登录时间和IP
- **课程操作**：添加、修改、删除课程
- **用户操作**：次卡充值、扣减等
- **系统操作**：重要配置修改

### 查看日志
1. 点击"操作日志"进入日志页面
2. 可以按时间、操作类型筛选
3. 每条日志包含：
   - **操作时间**：具体到分钟
   - **操作人员**：哪个管理员操作的
   - **操作内容**：具体做了什么
   - **操作结果**：成功或失败

---

## ⚙️ 管理员账号管理

### 重要提醒：权限设置问题解决

⚠️ **当前系统存在权限验证问题**：虽然可以使用预设账号登录，但执行管理操作时可能提示"无管理员权限"。

#### 解决方法：

**步骤1：获取你的微信OpenID**
1. 上传临时云函数 `getAdminOpenid`（项目中已包含）
2. 在小程序中调用该云函数：
```javascript
wx.cloud.callFunction({
  name: 'getAdminOpenid',
  success: res => {
    console.log('你的OpenID是：', res.result.openid);
    // 记录这个openid，下一步要用
  }
});
```

**步骤2：将OpenID添加到云函数中**
编辑以下4个云函数文件，找到 `defaultAdminOpenids` 数组，添加你的openid：
- `cloudfunctions/adminAddCourse/index.js`
- `cloudfunctions/adminAddSchedule/index.js` 
- `cloudfunctions/adminUpdateCredits/index.js`
- `cloudfunctions/getAllUsers/index.js`

修改示例：
```javascript
const defaultAdminOpenids = [
  'your-actual-openid-here', // 替换为步骤1获取的真实openid
  // 'another-admin-openid-here' // 可以添加多个管理员
];
```

**步骤3：重新部署云函数**
1. 在微信开发者工具中右键每个修改过的云函数文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

**步骤4：删除临时云函数**
设置完成后，可以删除 `getAdminOpenid` 云函数以保持项目整洁。

### 添加新管理员
如需添加新的管理员：
1. 获取新管理员的微信OpenID（使用上述方法）
2. 将OpenID添加到各云函数的 `defaultAdminOpenids` 数组中
3. 重新部署相关云函数

### 权限说明
- **超级管理员**：拥有所有权限，包括用户管理、课程管理、数据查看等
- **普通管理员**：拥有课程管理和用户管理权限，无法查看敏感数据

---

## 🔒 安全注意事项

### 账号安全
- ✅ **定期修改密码**：建议每3个月更换一次密码
- ✅ **不要共享账号**：每位管理员使用独立账号
- ✅ **安全退出**：使用完毕后点击退出登录
- ✅ **设备安全**：不要在公共设备上登录

### 操作安全
- ⚠️ **谨慎操作**：删除课程和修改用户次卡前请再次确认
- ⚠️ **备份重要数据**：重要操作前建议先导出数据
- ⚠️ **及时处理异常**：发现异常预约或数据及时联系技术支持

---

## 💡 常见问题解答

### Q1: 忘记管理员密码怎么办？
**A**: 联系技术支持人员重置密码，或使用其他管理员账号登录。

### Q2: 为什么看不到管理员入口？
**A**: 需要在"我的"页面长按设置图标⚙️大约2秒才会出现入口。

### Q3: 用户次卡操作错误如何撤销？
**A**: 可以通过相反操作来撤销，如充错了就扣减相应次数。

### Q4: 课程安排冲突怎么处理？
**A**: 系统会检测时间冲突，如果出现冲突请调整时间或教室。

### Q5: 如何查看某个课程的预约情况？
**A**: 在课程管理页面点击具体课程，可以看到详细的预约信息。

### Q6: 用户取消预约后次卡会返还吗？
**A**: 系统会自动返还次卡，无需手动操作。

### Q7: 如何导出用户数据？
**A**: 目前需要联系技术支持导出，后续版本会增加自助导出功能。

---

## 📞 技术支持

如遇到系统问题或需要技术支持，请联系：

- **技术支持邮箱**：support@yogastudio.com
- **客服热线**：400-XXX-XXXX
- **工作时间**：周一至周五 9:00-18:00

---

## 📝 版本更新日志

### v1.1 (2024-01-02)
- ✅ 更新用户登录机制
- ✅ 集成微信头像昵称填写能力
- ✅ 添加手机号验证功能
- ✅ 优化用户资料编辑功能
- ✅ 解决用户重复注册问题

### v1.0 (2024-01-01)
- ✅ 发布管理员登录系统
- ✅ 实现课程管理功能
- ✅ 实现用户管理功能
- ✅ 添加数据统计功能
- ✅ 添加操作日志功能

---

## 📋 操作检查清单

### 每日操作检查
- [ ] 查看今日预约情况
- [ ] 检查课程安排是否有冲突
- [ ] 确认当日授课老师安排
- [ ] 查看是否有异常预约需要处理

### 每周操作检查
- [ ] 安排下周课程日程
- [ ] 检查热门课程是否需要加课
- [ ] 统计本周预约数据
- [ ] 处理用户次卡充值需求

### 每月操作检查
- [ ] 生成月度数据报表
- [ ] 分析用户活跃度
- [ ] 评估课程受欢迎程度
- [ ] 规划下月课程安排

---

**🎉 恭喜您！现在您已经完全掌握了瑜伽馆小程序的管理功能。**

> 💡 **小贴士**：建议打印这份手册或保存到手机上，方便随时查阅！
