# 管理员入口说明

## 概述
为了提高系统的安全性和隐私性，管理员入口逻辑已经重新设计，现在分为两种不同的访问方式：

## 1. 管理员入口 ⚙️
- **验证方式**: 基于微信openid验证
- **权限来源**: `admins`集合中的记录
- **访问流程**: 
  1. 点击"管理员入口"按钮
  2. 系统自动验证当前用户的openid
  3. 如果openid在`admins`集合中且状态为`active`，直接进入管理页面
  4. 如果验证失败，显示"权限不足"提示

## 2. 老师入口 👩‍🏫
- **验证方式**: 用户名密码登录
- **权限来源**: 预设的老师账号或`admins`集合中的老师账号
- **访问流程**:
  1. 点击"老师入口"按钮
  2. 跳转到登录页面
  3. 输入用户名和密码
  4. 验证成功后进入管理页面

## 数据库结构

### admins集合字段
```json
{
  "_id": "文档ID",
  "openid": "微信用户的openid",
  "name": "显示名称",
  "role": "角色(admin/teacher/super_admin)",
  "status": "状态(active/inactive)",
  "permissions": ["权限列表"],
  "createdAt": "创建时间",
  "updatedAt": "更新时间"
}
```

## 配置管理员权限

### 方法1: 直接在数据库中添加
在微信云开发控制台的数据库中，向`admins`集合添加记录：

```json
{
  "openid": "用户的微信openid",
  "name": "管理员姓名",
  "role": "admin",
  "status": "active",
  "permissions": ["all"],
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### 方法2: 使用getAdminOpenid云函数获取openid
1. 让需要设置为管理员的用户登录小程序
2. 在云开发控制台调用`getAdminOpenid`云函数
3. 获取返回的openid
4. 在`admins`集合中添加该openid的记录

## 安全特性

1. **管理员入口**: 无需密码，基于微信身份验证，更安全便捷
2. **老师入口**: 保留原有的用户名密码验证，适合非管理员的老师使用
3. **双重验证**: admin页面支持两种验证方式，确保系统的兼容性
4. **权限分离**: 管理员和老师的权限可以分别管理

## 注意事项

1. 管理员openid验证是一次性配置，配置后该用户可以直接访问管理功能
2. 如需撤销管理员权限，只需将`admins`集合中对应记录的`status`改为`inactive`
3. 老师入口保持原有功能不变，确保现有老师用户的正常使用
4. 建议定期检查和更新管理员权限，确保系统安全
