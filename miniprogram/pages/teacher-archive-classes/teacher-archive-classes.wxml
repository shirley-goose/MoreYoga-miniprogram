<!-- è€å¸ˆå·²ç»“è¯¾ç¨‹é¡µé¢ -->
<!-- èƒŒæ™¯å›¾ -->
<image class="global-bg" src="../../images/background.png" mode="aspectFill"/>

<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="nav-bar">
  <view class="nav-left">
    <view class="back-btn" bindtap="goBack">
      <view class="back-icon">â†</view>
    </view>
  </view>
  <view class="nav-center">
    <view class="nav-title">å·²ç»“è¯¾ç¨‹</view>
  </view>
  <view class="nav-right"></view>
</view>

<!-- é¡µé¢å†…å®¹ -->
<view class="container">
  
  <!-- è¯¾ç¨‹ç±»å‹åˆ‡æ¢ -->
  <view class="course-tabs">
    <view class="tab-item {{currentTab === 'private' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="private">
      <text class="tab-text">ç§æ•™è¯¾</text>
      <view wx:if="{{privateCourses.length > 0}}" class="tab-count">{{privateCourses.length}}</view>
    </view>
    <view class="tab-item {{currentTab === 'group' ? 'active' : ''}}" 
          bindtap="switchTab" 
          data-tab="group">
      <text class="tab-text">å›¢è¯¾</text>
      <view wx:if="{{groupCourses.length > 0}}" class="tab-count">{{groupCourses.length}}</view>
    </view>
  </view>

  <!-- ç§æ•™è¯¾ç¨‹åˆ—è¡¨ -->
  <view wx:if="{{currentTab === 'private'}}">
    <view wx:if="{{privateCourses.length > 0}}" class="courses-list">
      <view class="list-header">
        <view class="header-text">å·²å®Œæˆç§æ•™è¯¾ç¨‹ ({{privateCourses.length}}èŠ‚)</view>
        <view class="header-desc">æŒ‰å®Œæˆæ—¶é—´æ’åº</view>
      </view>
      
      <view class="course-item archived" 
            wx:for="{{privateCourses}}" 
            wx:key="_id">
        <view class="course-header">
          <view class="course-type-label private">ç§æ•™</view>
          <view class="course-status completed">
            <text>å·²å®Œæˆ</text>
          </view>
        </view>
        
        <view class="course-content">
          <view class="course-info">
            <view class="course-title">ç§æ•™è¯¾ç¨‹</view>
            <view class="course-time">{{item.date}} {{item.timeRange}}</view>
            <view class="student-info">
              <text class="student-name">å­¦å‘˜ï¼š{{item.studentName}}</text>
              <text class="student-phone">{{item.studentPhone}}</text>
            </view>
            <view wx:if="{{item.content}}" class="course-content-text">
              <text class="content-label">éœ€æ±‚ï¼š</text>
              <text class="content-text">{{item.content}}</text>
            </view>
            <view wx:if="{{item.completedAt && item.completedAt !== 'æœªè®°å½•'}}" class="completion-time">
              <text class="completion-label">å®Œæˆæ—¶é—´ï¼š</text>
              <text class="completion-text">{{item.completedAtDisplay || item.completedAt}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“š</view>
      <text class="empty-text">æš‚æ— å·²å®Œæˆçš„ç§æ•™è¯¾ç¨‹</text>
      <text class="empty-hint">å®Œæˆçš„ç§æ•™è¯¾ç¨‹ä¼šåœ¨è¿™é‡Œæ˜¾ç¤º</text>
    </view>
  </view>

  <!-- å›¢è¯¾è¯¾ç¨‹åˆ—è¡¨ -->
  <view wx:if="{{currentTab === 'group'}}">
    <view wx:if="{{groupCourses.length > 0}}" class="group-course-list">
      <view class="list-header">
        <view class="header-text">å·²å®Œæˆå›¢è¯¾ ({{groupCourses.length}}èŠ‚)</view>
        <view class="header-desc">æŒ‰å®Œæˆæ—¶é—´æ’åº</view>
      </view>

      <view class="group-course-item archived" 
            wx:for="{{groupCourses}}" 
            wx:key="_id"
            bindtap="toggleGroupCourseDetail" 
            data-index="{{index}}">
        
        <!-- è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ -->
        <view class="group-course-info">
          <view class="group-course-header">
            <view class="group-course-title">{{item.courseName}}</view>
            <view class="booking-count completed">
              <text class="count-number">{{item.completedBookings}}</text>
              <text class="count-label">äººå®Œæˆ</text>
            </view>
          </view>
          
          <view class="group-course-details">
            <view class="detail-item">
              <text class="detail-icon">ğŸ“…</text>
              <text class="detail-text">{{item.dateDisplay}}</text>
            </view>
            <view class="detail-item">
              <text class="detail-icon">ğŸ•</text>
              <text class="detail-text">{{item.startTime}} - {{item.endTime}}</text>
            </view>
            <view class="detail-item">
              <text class="detail-icon">âœ…</text>
              <text class="detail-text completed-text">å·²å®Œæˆ</text>
            </view>
          </view>

          <!-- ç»Ÿè®¡ä¿¡æ¯ -->
          <view class="stats-info">
            <text class="stat-item total">æ€»è®¡: {{item.totalBookings}}</text>
            <text class="stat-item completed">å®Œæˆ: {{item.completedBookings}}</text>
            <text class="stat-item cancelled">å–æ¶ˆ: {{item.cancelledBookings}}</text>
            <text class="stat-item failed">å¤±è´¥: {{item.failedBookings}}</text>
          </view>

          <!-- å±•å¼€/æ”¶èµ·å›¾æ ‡ -->
          <view class="expand-icon">
            <text class="expand-text">{{item.showDetail ? 'æ”¶èµ·' : 'æŸ¥çœ‹è¯¦æƒ…'}}</text>
            <text class="expand-arrow">{{item.showDetail ? 'â–²' : 'â–¼'}}</text>
          </view>
        </view>

        <!-- å‚ä¸å­¦å‘˜åˆ—è¡¨ -->
        <view wx:if="{{item.showDetail}}" class="group-booking-list">
          <view wx:if="{{item.bookings.length === 0}}" class="no-bookings">
            <text class="no-bookings-text">æ— å‚ä¸å­¦å‘˜</text>
          </view>
          
          <view wx:else class="booking-students">
            <view class="students-header">çº¦è¯¾å­¦å‘˜åˆ—è¡¨ï¼š</view>
            <view class="student-item" wx:for="{{item.bookings}}" wx:for-item="booking" wx:key="id">
              <view class="student-info">
                <view class="student-name">{{booking.userName}}</view>
                <view class="student-phone">{{booking.userPhone}}</view>
                <view wx:if="{{booking.cancelTimeDisplay}}" class="cancel-time">
                  å–æ¶ˆæ—¶é—´: {{booking.cancelTimeDisplay}}
                </view>
              </view>
              <view class="booking-status {{booking.status}}">
                {{booking.statusText}}
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“š</view>
      <text class="empty-text">æš‚æ— å·²å®Œæˆçš„å›¢è¯¾</text>
      <text class="empty-hint">å®Œæˆçš„å›¢è¯¾ä¼šåœ¨è¿™é‡Œæ˜¾ç¤º</text>
    </view>
  </view>

</view>
