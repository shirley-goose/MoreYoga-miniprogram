<!-- æˆ‘ï¼ˆä¸ªäººä¸­å¿ƒï¼‰é¡µé¢ -->
<!-- èƒŒæ™¯å›¾ -->
<image class="global-bg" src="../../images/background.png" mode="aspectFill"/>

<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="nav-bar">
  <view class="nav-left"></view>
  <view class="nav-title">å¢¨ç‘œä¼½</view>
  <view class="nav-right"></view>
</view>



<view class="page-container">
  <view class="container">

  <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šä¸ªäººä¿¡æ¯ -->
  <view class="profile-info-section">
    <view class="profile-card">
      
      <!-- æœªç™»å½•çŠ¶æ€ - ç®€åŒ–ç‰ˆæœ¬ -->
      <block wx:if="{{!hasUserInfo}}">
        <view class="profile-info">
          <!-- å¤´åƒ - ç‚¹å‡»é€‰æ‹©å¤´åƒ -->
          <button class="avatar-btn placeholder-avatar" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
            <image wx:if="{{avatarUrl && avatarUrl !== defaultAvatarUrl}}" class="avatar" src="{{avatarUrl}}" mode="aspectFill"/>
            <view wx:else class="avatar placeholder-avatar"></view>
          </button>
          <view class="user-info">
            <!-- æ˜¾ç¤ºæ‰‹æœºå·æˆ–ç™»å½•æŒ‰é’® -->
            <text wx:if="{{phoneNumber}}" class="phone-display">{{phoneNumber}}</text>
            <button wx:else class="login-btn" open-type="getPhoneNumber" bind:getphonenumber="onGetPhoneNumber">
              <text class="login-text">ç‚¹å‡»ç™»å½•</text>
            </button>
          </view>
        </view>
      </block>

      <!-- å·²ç™»å½•çŠ¶æ€ -->
      <block wx:elif="{{hasUserInfo}}">
        <view class="profile-info">
          <!-- å¤´åƒ -->
          <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"/>
          <view class="user-info">
            <!-- æ˜¾ç¤ºæ‰‹æœºå·è€Œä¸æ˜¯æ˜µç§° -->
            <text class="phone-display">{{userInfo.phoneNumber || 'æœªç»‘å®šæ‰‹æœºå·'}}</text>
          </view>
        </view>
        <!-- è¯¾æ—¶æ˜¾ç¤ºåœ¨å¡ç‰‡å†…éƒ¨ -->
        <view class="credits-display">
          <view class="credit-item">
            <text class="credit-number">{{classCredits.term}}</text>
            <text class="credit-label">ç§ æ•™</text>
          </view>
          <view class="credit-item">
            <text class="credit-number">{{classCredits.group}}</text>
            <text class="credit-label">å›¢ è¯¾</text>
          </view>
        </view>
      </block>

    </view>
  </view>



  <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šå·²çº¦è¯¾ç¨‹ -->
  <view class="booked-courses-section">
    <view class="section-header">
      <view class="section-title">å·²çº¦å›¢è¯¾</view>
      <view class="section-actions">
        <text wx:if="{{hasUserInfo}}" class="section-notice">è·å›¢è¯¾å¼€å§‹æ—¶é—´1hå†…ä¸å¯å–æ¶ˆ</text>
      </view>
    </view>
    <view class="courses-list">
      <block wx:if="{{hasUserInfo}}">
        <block wx:for="{{schedule}}" wx:key="id">
          <view class="course-card">
            <image class="course-image" src="{{item.courseImage || '../../images/default_course.png'}}" mode="aspectFill"/>
            <view class="course-info">
              <view class="course-name">{{item.courseName || 'ç‘œä¼½è¯¾ç¨‹'}}</view>
              <view class="teacher-name">{{item.teacherName || 'è€å¸ˆ'}}</view>
              <view class="course-time">{{item.date}} {{item.time}}</view>
            </view>
            <view class="course-status">
              <view class="status-btn ended-btn" wx:if="{{item.isEnded}}">
                å·²ç»“æŸ
              </view>
              <view wx:elif="{{item.isWaitlist}}" class="waitlist-status">
                <view class="status-btn waitlist-btn">
                  ç­‰ä½ä¸­ {{item.position ? 'ç¬¬' + item.position + 'ä½' : ''}}
                </view>
                <view wx:if="{{item.waitingAhead !== undefined}}" class="waiting-info">
                  å‰é¢è¿˜æœ‰ {{item.waitingAhead}} äºº
                </view>
                <view wx:if="{{item.canCancel}}" class="status-btn cancel-btn" bindtap="cancelCourse" data-id="{{item.id}}">
                  å–æ¶ˆç­‰ä½
                </view>
              </view>
              <view wx:elif="{{!item.isWaitlist}}" class="booked-status">
                <view wx:if="{{item.hasWaitlist}}" class="waitlist-info">
                  æœ‰{{item.waitlistCount}}äººç­‰ä½
                </view>
                <view class="status-btn cancel-btn" wx:if="{{item.canCancel}}" bindtap="cancelCourse" data-id="{{item.id}}">
                  å–æ¶ˆé¢„çº¦
                </view>
                <view class="status-btn disabled-btn" wx:else>
                  å·²ç¡®è®¤
                </view>
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{schedule.length === 0}}" class="empty-state">
          <text class="empty-text">æš‚æ— å·²çº¦è¯¾ç¨‹</text>
          <text class="empty-hint">å¿«å»é¢„çº¦æ‚¨å–œæ¬¢çš„è¯¾ç¨‹å§ï¼</text>
        </view>
      </block>
      <block wx:else>
        <view class="empty-state">
          <text class="empty-text">æš‚æ— æ—¥ç¨‹ï¼Œè¯·ç™»å½•åæŸ¥çœ‹</text>
        </view>
      </block>
    </view>
    <!-- æŸ¥çœ‹æ‰€æœ‰è®°å½•æŒ‰é’® - å³å¯¹é½ -->
    <view wx:if="{{hasUserInfo}}" class="view-history-container">
      <text class="view-history" bindtap="viewBookingHistory">æŸ¥çœ‹æ‰€æœ‰è®°å½• ></text>
    </view>
  </view>

  <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå·²çº¦ç§æ•™ -->
  <view class="booked-private-section">
    <view class="section-header">
      <view class="section-title">å·²çº¦ç§æ•™</view>
      <view class="section-actions">
        <text wx:if="{{hasUserInfo}}" class="section-notice">è·ç§æ•™å¼€å§‹æ—¶é—´1hå†…ä¸å¯å–æ¶ˆ</text>
      </view>
    </view>
    <view class="courses-list">
      <block wx:if="{{hasUserInfo}}">
        <block wx:for="{{privateBookings}}" wx:key="_id">
          <view class="course-card private-card">
            <image class="course-image" src="../../images/logo.png" mode="aspectFill"/>
            <view class="course-info">
              <view class="course-name">ç§æ•™è¯¾ç¨‹</view>
              <view class="teacher-name">{{item.teacherName}}</view>
              <view class="course-time">{{item.date}} {{item.timeRange}}</view>
              <view wx:if="{{item.content}}" class="course-content">éœ€æ±‚ï¼š{{item.content}}</view>
            </view>
            
            <!-- çŠ¶æ€æ ‡ç­¾ - å³ä¸Šè§’ -->
            <view class="course-status-top">
              <view class="status-btn ended-btn" wx:if="{{item.isEnded}}">
                å·²ç»“æŸ
              </view>
              <view class="status-btn confirmed-btn" wx:elif="{{item.displayStatus === 'confirmed'}}">
                å·²ç¡®è®¤
              </view>
              <view class="status-btn pending-btn" wx:elif="{{item.displayStatus === 'pending'}}">
                å¾…ç¡®è®¤
              </view>
              <view class="status-btn cancel-pending-btn" wx:elif="{{item.displayStatus === 'cancel-pending'}}">
                ç”³è¯·å–æ¶ˆä¸­
              </view>
              <view class="status-btn cancelled-btn" wx:elif="{{item.displayStatus === 'cancelled'}}">
                å·²å–æ¶ˆ
              </view>
              <view class="status-btn rejected-btn" wx:elif="{{item.displayStatus === 'rejected'}}">
                å·²æ‹’ç»
              </view>
            </view>
            
            <!-- æ“ä½œæŒ‰é’® - å³ä¸‹è§’ -->
            <view class="course-actions-bottom" wx:if="{{!item.isEnded && item.displayStatus !== 'cancelled' && item.displayStatus !== 'cancel-pending'}}">
              <view class="action-btn cancel-btn" bindtap="cancelPrivateBooking" data-id="{{item._id}}" data-status="{{item.status}}" data-date="{{item.date}}" data-start-time="{{item.startTime}}" data-cancel-request-status="{{item.cancelRequestStatus}}">
                {{item.cancelRequestStatus === 'rejected' ? 'é‡æ–°ç”³è¯·å–æ¶ˆ' : 'å–æ¶ˆé¢„çº¦'}}
              </view>
            </view>
          </view>
        </block>
        <view wx:if="{{privateBookings.length === 0}}" class="empty-state">
          <text class="empty-text">æš‚æ— å·²çº¦ç§æ•™</text>
          <text class="empty-hint">å¿«å»é¢„çº¦æ‚¨çš„ä¸“å±ç§æ•™å§ï¼</text>
        </view>
      </block>
      <block wx:else>
        <view class="empty-state">
          <text class="empty-text">æš‚æ— ç§æ•™å®‰æ’ï¼Œè¯·ç™»å½•åæŸ¥çœ‹</text>
        </view>
      </block>
    </view>
    <!-- æŸ¥çœ‹å¾€æœŸè®°å½•æŒ‰é’® - å³å¯¹é½ -->
    <view wx:if="{{hasUserInfo}}" class="view-history-container">
      <text class="view-history" bindtap="viewPrivateHistory">æŸ¥çœ‹å¾€æœŸè®°å½• ></text>
    </view>
  </view>

  <!-- ç¬¬å››éƒ¨åˆ†ï¼šæ›´å¤šæœåŠ¡ -->
  <view class="more-services-section">
    <view class="section-header">
      <view class="section-title">æ›´å¤šæœåŠ¡</view>
    </view>
    <view class="services-grid">
      <view class="service-item" bindtap="contactService">
        <image class="service-icon" src="../../images/icon_contact.png" mode="aspectFit"/>
        <view class="service-name">è”ç³»å®¢æœ</view>
      </view>
      <view class="service-item" bindtap="joinCommunity">
        <image class="service-icon" src="../../images/icon_community.png" mode="aspectFit"/>
        <view class="service-name">åŠ å…¥ç¤¾ç¾¤</view>
      </view>
      <view class="service-item" bindtap="giveFeedback">
        <image class="service-icon" src="../../images/icon_feedback.png" mode="aspectFit"/>
        <view class="service-name">æå‡ºå»ºè®®</view>
      </view>
      <view class="service-item" bindtap="buyCourse">
        <image class="service-icon" src="../../images/icon_buy.png" mode="aspectFit"/>
        <view class="service-name">è´­ä¹°è¯¾ç¨‹</view>
      </view>
    </view>
  </view>

  <!-- ç¬¬å››éƒ¨åˆ†ï¼šæˆ‘çš„è¶³è¿¹ -->
  <view class="footprints-section">
    <view class="section-header">
      <view class="section-title">æˆ‘çš„è¶³è¿¹</view>
    </view>
    <view class="footprints-card">
      <view class="development-notice">
        <text class="notice-icon">ğŸš§</text>
        <text class="notice-text">åŠŸèƒ½å¼€å‘ä¸­</text>
        <text class="notice-desc">æ•¬è¯·æœŸå¾…æ›´ç²¾å½©çš„è¶³è¿¹åŠŸèƒ½</text>
      </view>
    </view>
  </view>

  <!-- ç®¡ç†å‘˜å…¥å£å’Œè€å¸ˆå…¥å£æŒ‰é’® - ä½äºé¡µé¢åº•éƒ¨å±…ä¸­ -->
  <view wx:if="{{hasUserInfo}}" class="admin-entry-bottom">
    <view class="admin-entry" bindtap="checkAdminAccess">
      <text class="admin-icon">âš™ï¸</text>
      <text class="admin-text">ç®¡ç†å‘˜å…¥å£</text>
    </view>
    <view class="teacher-entry" bindtap="checkTeacherAccess">
      <text class="teacher-icon">ğŸ‘©â€ğŸ«</text>
      <text class="teacher-text">è€å¸ˆå…¥å£</text>
    </view>
  </view>

</view>
</view> 