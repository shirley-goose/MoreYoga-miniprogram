# 📋 墨瑜伽约课系统 - 部署清单

## 🎯 部署前准备

### ✅ 环境要求检查
- [ ] 微信开发者工具（最新版本）
- [ ] 微信小程序账号（已认证）
- [ ] 云开发服务已开通
- [ ] 网络环境良好

### ✅ 项目文件检查
- [ ] 所有源代码文件完整
- [ ] 云函数代码无语法错误
- [ ] 配置文件格式正确
- [ ] 图片资源文件存在

## 🔧 配置步骤

### 1. 云环境配置
- [ ] 创建云环境：`yoga-booking-system`
- [ ] 记录云环境ID
- [ ] 更新 `miniprogram/app.js` 中的环境ID：
  ```javascript
  env: 'your-cloud-env-id' // 替换为实际ID
  ```

### 2. 管理员配置
- [ ] 获取管理员微信 openid
- [ ] 更新 `miniprogram/app.js` 中的管理员列表：
  ```javascript
  adminList: ['your-admin-openid-here']
  ```

## 🗄️ 数据库设置

### 集合创建
- [ ] 创建 `users` 集合
- [ ] 创建 `courses` 集合
- [ ] 创建 `courseSchedule` 集合
- [ ] 创建 `bookings` 集合
- [ ] 创建 `classRecords` 集合
- [ ] 创建 `notifications` 集合
- [ ] 创建 `admins` 集合
- [ ] 创建 `adminLogs` 集合

### 权限设置
- [ ] `users` 集合：读写权限为用户本人
- [ ] `courses` 集合：只读权限
- [ ] `courseSchedule` 集合：只读权限
- [ ] `bookings` 集合：用户本人读写权限
- [ ] 其他集合：无权限（通过云函数访问）

### 索引创建
- [ ] `users.openid` 单字段索引
- [ ] `bookings.userId` 单字段索引
- [ ] `bookings.scheduleId` 单字段索引
- [ ] `courseSchedule.date` 单字段索引
- [ ] `notifications.userId` 单字段索引

### 初始数据
- [ ] 在 `admins` 集合添加管理员记录
- [ ] 创建测试课程数据（可选）
- [ ] 创建测试用户数据（可选）

## ☁️ 云函数部署

### 基础云函数
- [ ] `login` - 用户登录
- [ ] `getUser` - 获取用户信息
- [ ] `registerUser` - 用户注册
- [ ] `getUserCredits` - 获取用户次卡余额

### 预约相关云函数
- [ ] `getDaySchedule` - 获取每日课程安排
- [ ] `bookCourse` - 预约课程
- [ ] `cancelBooking` - 取消预约
- [ ] `getUserBookings` - 获取用户预约记录

### 通知系统云函数
- [ ] `sendNotification` - 发送通知
- [ ] `courseReminder` - 课程提醒

### 管理员云函数
- [ ] `adminAddCourse` - 管理员添加课程
- [ ] `adminAddSchedule` - 管理员添加课程安排
- [ ] `adminUpdateCredits` - 管理员更新用户课时
- [ ] `getAllUsers` - 获取所有用户
- [ ] `getCourses` - 获取课程列表

### 定时器设置
- [ ] 为 `courseReminder` 设置定时器
- [ ] 触发周期：`0 * * * * * *`（每小时）
- [ ] 验证定时器正常运行

## 📱 小程序配置

### 页面路由检查
- [ ] 所有页面已添加到 `app.json`
- [ ] 页面路径正确无误
- [ ] 自定义 TabBar 配置正确

### 权限申请
- [ ] 用户信息授权
- [ ] 订阅消息权限
- [ ] 其他必要权限

## 🔔 消息模板配置

### 订阅消息模板申请
- [ ] 预约成功通知模板
- [ ] 课程确认通知模板
- [ ] 课程提醒通知模板
- [ ] 课程取消通知模板

### 模板ID配置
- [ ] 更新 `sendNotification` 云函数中的模板ID
- [ ] 测试消息发送功能

## 🧪 功能测试

### 用户功能测试
- [ ] 用户注册登录
- [ ] 查看课程列表
- [ ] 预约课程功能
- [ ] 取消预约功能
- [ ] 等位功能
- [ ] 次卡余额显示
- [ ] 预约历史查看

### 管理员功能测试
- [ ] 管理员权限验证
- [ ] 添加课程功能
- [ ] 安排课程日程
- [ ] 用户次卡管理
- [ ] 用户列表查看

### 通知功能测试
- [ ] 预约成功通知
- [ ] 课程提醒通知
- [ ] 等位转正通知
- [ ] 成课确认通知

### 业务逻辑测试
- [ ] 并发预约处理
- [ ] 等位队列机制
- [ ] 开课前1小时限制
- [ ] 最少成课人数检查
- [ ] 数据一致性验证

## 🚀 上线准备

### 代码审查
- [ ] 代码无语法错误
- [ ] 逻辑漏洞检查
- [ ] 安全问题排查
- [ ] 性能优化确认

### 用户体验检查
- [ ] 界面美观统一
- [ ] 交互流畅自然
- [ ] 错误提示友好
- [ ] 加载状态明确

### 数据安全
- [ ] 敏感信息保护
- [ ] 数据库权限最小化
- [ ] 云函数权限验证
- [ ] 用户隐私保护

## 📋 上线清单

### 最终检查
- [ ] 所有功能正常运行
- [ ] 测试用例全部通过
- [ ] 性能指标符合要求
- [ ] 文档齐全完整

### 备份策略
- [ ] 代码版本管理
- [ ] 数据库备份
- [ ] 配置文件备份
- [ ] 回滚方案准备

### 监控告警
- [ ] 云函数执行监控
- [ ] 数据库性能监控
- [ ] 用户访问统计
- [ ] 错误日志收集

## ⚠️ 注意事项

### 安全提醒
1. **管理员权限**：确保管理员 openid 正确且保密
2. **数据库权限**：严格按照最小权限原则设置
3. **云函数安全**：所有管理员操作都要验证权限
4. **用户隐私**：遵守数据保护法规

### 性能建议
1. **数据库索引**：为高频查询字段建立索引
2. **云函数优化**：控制函数执行时间和内存使用
3. **图片优化**：使用适当尺寸的图片资源
4. **缓存策略**：合理使用缓存减少数据库访问

### 运维建议
1. **定期备份**：建立定期数据备份机制
2. **监控告警**：设置关键指标监控
3. **日志分析**：定期分析系统日志
4. **用户反馈**：建立用户反馈渠道

## ✅ 完成确认

当您完成以上所有检查项目后，您的墨瑜伽约课系统就可以正式上线运行了！

**最终确认**：
- [ ] 所有功能测试通过
- [ ] 数据安全措施到位
- [ ] 用户体验良好
- [ ] 系统性能稳定
- [ ] 文档齐全完整

**🎉 恭喜您成功部署了完整的约课系统！**
